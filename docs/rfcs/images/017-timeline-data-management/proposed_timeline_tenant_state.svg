<?xml version="1.0" encoding="UTF-8"?>
<!-- Do not edit this file with editors other than diagrams.net -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1284px" height="1091px" viewBox="-0.5 -0.5 1284 1091" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2022-07-27T17:49:56.955Z&quot; agent=&quot;5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36&quot; etag=&quot;FOCd-CT1xLcpFFVJFxeo&quot; version=&quot;20.2.0&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;O-UwVOdaADe9p4iTUtC-&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs><clipPath id="mx-clip-885-80-332-70-0"><rect x="885" y="80" width="332" height="70"/></clipPath><clipPath id="mx-clip-885-410-332-120-0"><rect x="885" y="410" width="332" height="120"/></clipPath><clipPath id="mx-clip-25-510-302-70-0"><rect x="25" y="510" width="302" height="70"/></clipPath><clipPath id="mx-clip-25-270-302-70-0"><rect x="25" y="270" width="302" height="70"/></clipPath><clipPath id="mx-clip-885-560-332-90-0"><rect x="885" y="560" width="332" height="90"/></clipPath><clipPath id="mx-clip-25-630-302-60-0"><rect x="25" y="630" width="302" height="60"/></clipPath><clipPath id="mx-clip-25-390-302-70-0"><rect x="25" y="390" width="302" height="70"/></clipPath><clipPath id="mx-clip-25-70-302-80-0"><rect x="25" y="70" width="302" height="80"/></clipPath><clipPath id="mx-clip-885-180-332-90-0"><rect x="885" y="180" width="332" height="90"/></clipPath><clipPath id="mx-clip-376-70-302-80-0"><rect x="376" y="70" width="302" height="80"/></clipPath></defs><g><path d="M 1 20 L 1 0 L 1281 0 L 1281 20" fill="rgb(255, 255, 255)" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 1 20 L 1 890 L 1281 890 L 1281 20" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 1 20 L 1281 20" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" font-size="12px"><text x="2.5" y="14.5">s</text></g><path d="M 661 740 L 661 740 L 741 740 L 741 740" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 661 740 L 661 770 L 741 770 L 741 740" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="700.5" y="758.5">Layer 1</text></g><path d="M 751 740 L 751 740 L 831 740 L 831 740" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 751 740 L 751 770 L 831 770 L 831 740" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="790.5" y="758.5">Layer 2</text></g><path d="M 961 770 L 961 790.05 L 961 780.05 L 961 789.9" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 961 796.65 L 956.5 787.65 L 961 789.9 L 965.5 787.65 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 785px; margin-left: 961px;"><div data-drawio-colors="color: #000000; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; background-color: rgb(255, 255, 255); white-space: nowrap;">contained in</div></div></div></foreignObject><text x="961" y="789" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">contained in</text></switch></g><path d="M 921 740 L 921 740 L 1001 740 L 1001 740" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 921 740 L 921 770 L 1001 770 L 1001 740" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="960.5" y="758.5">metadata</text></g><path d="M 661 800 L 661 800 L 741 800 L 741 800" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 661 800 L 661 830 L 741 830 L 741 800" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="700.5" y="818.5">Layer 1</text></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 815px; margin-left: 866px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; font-weight: bold; white-space: nowrap;">...</div></div></div></foreignObject><text x="866" y="819" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">...</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 765px; margin-left: 866px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; font-weight: bold; white-space: nowrap;">...</div></div></div></foreignObject><text x="866" y="769" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">...</text></switch></g><path d="M 906 800 L 906 800 L 1016 800 L 1016 800" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 906 800 L 906 830 L 1016 830 L 1016 800" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="960.5" y="818.5">index_part.json</text></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 815px; margin-left: 1171px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; font-weight: bold; white-space: nowrap;">Files in the remote storage</div></div></div></foreignObject><text x="1171" y="819" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">Files in the remote storage</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 760px; margin-left: 1151px;"><div data-drawio-colors="color: #000000; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; font-weight: bold; white-space: nowrap;">Files in the local FS</div></div></div></foreignObject><text x="1151" y="764" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">Files in the local FS</text></switch></g><path d="M 881 80 L 881 50 L 1221 50 L 1221 80" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 881 80 L 881 150 L 1221 150 L 1221 80" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 881 80 L 1221 80" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="1050.5" y="69.5">Tenant</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-885-80-332-70-0)" font-size="12px"><text x="886.5" y="106.5">a number of maps with Arc&lt;RwLock&lt;Data&gt;&gt; pattern</text><text x="886.5" y="120.5">for tenants, timelines, gc, walreceiver, remove storage, etc. </text><text x="886.5" y="134.5">metadata</text></g><path d="M 881 410 L 881 380 L 1221 380 L 1221 410" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 881 410 L 881 530 L 1221 530 L 1221 410" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 881 410 L 1221 410" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="1050.5" y="399.5">LayeredTimeline</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-885-410-332-120-0)" font-size="12px"><text x="886.5" y="422.5">write_lock: Mutex&lt;()&gt;</text><text x="886.5" y="450.5">latest_gc_cutoff_lsn: RwLock&lt;Lsn&gt;</text><text x="886.5" y="478.5">process: Mutex&lt;Option&lt;PostgresRedoPorcess&gt;&gt; inside</text><text x="886.5" y="492.5">               PostgresRedoManager</text></g><path d="M 21 510 L 21 480 L 331 480 L 331 510" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 21 510 L 21 580 L 331 580 L 331 510" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 21 510 L 331 510" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="175.5" y="499.5">compaction</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-25-510-302-70-0)" font-size="12px"><text x="26.5" y="528.5">Periodically runs on all tenant timelines, </text><text x="26.5" y="542.5">each processed separately. </text><text x="26.5" y="570.5">Merges (removes and adds) layer files</text></g><path d="M 21 270 L 21 240 L 331 240 L 331 270" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 21 270 L 21 340 L 331 340 L 331 270" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 21 270 L 331 270" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="175.5" y="259.5">walreceiver tasks</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-25-270-302-70-0)" font-size="12px"><text x="26.5" y="302.5">etcd subscriptions, periodic timeline writes </text><text x="26.5" y="316.5">and checkpoints</text></g><path d="M 471 740 L 471 740 L 611 740 L 611 740" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 471 740 L 471 770 L 611 770 L 611 740" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="540.5" y="758.5">tenant config file</text></g><path d="M 881 560 L 881 530 L 1221 530 L 1221 560" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 881 560 L 881 650 L 1221 650 L 1221 560" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 881 560 L 1221 560" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="1050.5" y="549.5">LowLevelLayeredTimeline</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-885-560-332-90-0)" font-size="12px"><text x="886.5" y="588.5">partitioning: Mutex&lt;(KeyPartitioning, Lsn)&gt;</text><text x="886.5" y="616.5">layers: RwLock&lt;LayerMap&gt;</text></g><path d="M 1032.98 270.09 L 1033.6 367.8" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 1033.64 374.55 L 1029.08 365.57 L 1033.6 367.8 L 1038.08 365.52 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 324px; margin-left: 1033px;"><div data-drawio-colors="color: #000000; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; background-color: rgb(255, 255, 255); white-space: nowrap;">tenant contains timeline layer data</div></div></div></foreignObject><text x="1033" y="328" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">tenant con...</text></switch></g><path d="M 1 711 L 1281 710" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 21 630 L 21 600 L 331 600 L 331 630" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 21 630 L 21 690 L 331 690 L 331 630" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 21 630 L 331 630" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="175.5" y="619.5">remote storage sync</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-25-630-302-60-0)" font-size="12px"><text x="26.5" y="657.5">storage sync queue and S3 connections</text><text x="26.5" y="671.5">periodically writes into the remote index</text></g><path d="M 21 390 L 21 360 L 331 360 L 331 390" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 21 390 L 21 460 L 331 460 L 331 390" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 21 390 L 331 390" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="175.5" y="379.5">gc</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-25-390-302-70-0)" font-size="12px"><text x="26.5" y="408.5">Periodically runs on all tenant timelines, </text><text x="26.5" y="422.5">with shared context.</text><text x="26.5" y="450.5">Removes layer files</text></g><path d="M 869.92 616.51 L 351 310" fill="none" stroke="#ff1a12" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 875.73 619.94 L 865.69 619.24 L 869.92 616.51 L 870.27 611.49 Z" fill="#ff1a12" stroke="#ff1a12" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 431px; margin-left: 661px;"><div data-drawio-colors="color: #000000; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; background-color: rgb(255, 255, 255); white-space: nowrap;"><font color="#ff1a12">Tasks interact with layers, via LayerMap</font></div></div></div></foreignObject><text x="661" y="434" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">Tasks interact with layers, via LayerMap</text></switch></g><path d="M 21 70 L 21 40 L 331 40 L 331 70" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 21 70 L 21 150 L 331 150 L 331 70" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 21 70 L 331 70" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="175.5" y="59.5">task_manager</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-25-70-302-80-0)" font-size="12px"><text x="26.5" y="100.5">runtime, threadpools, shared connections (etcd), etc.</text><text x="26.5" y="128.5">logic to manage tenant/timeline tasks</text></g><path d="M 471 800 L 471 800 L 611 800 L 611 800" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 471 800 L 471 830 L 611 830 L 611 800" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="540.5" y="811.5">tenant config file </text><text x="540.5" y="825.5">in any form</text></g><path d="M 880.32 620.03 L 341.1 610.18" fill="none" stroke="#ff1a12" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 334.35 610.06 L 343.43 605.73 L 341.1 610.18 L 343.27 614.72 Z" fill="#ff1a12" stroke="#ff1a12" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 646px; margin-left: 602px;"><div data-drawio-colors="color: #000000; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; background-color: rgb(255, 255, 255); white-space: nowrap;"><font color="#ff1a12">layer map schedules sync tasks <br />and calls logic on their completion</font></div></div></div></foreignObject><text x="602" y="649" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">layer map schedules sync tasks...</text></switch></g><path d="M 881 180 L 881 150 L 1221 150 L 1221 180" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 881 180 L 881 270 L 1221 270 L 1221 180" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 881 180 L 1221 180" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="1050.5" y="169.5">page cache</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-885-180-332-90-0)" font-size="12px"><text x="886.5" y="201.5">materialized_page_map: RwLock&lt;HashMap&lt;...&gt;&gt;</text><text x="886.5" y="229.5">ephemeral_page_map: RwLock&lt;HashMap&lt;...&gt;&gt;</text><text x="886.5" y="257.5">immutable_page_map: RwLock&lt;HashMap&lt;...&gt;&gt;</text></g><path d="M 351 710 L 351 20" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 372 70 L 372 40 L 682 40 L 682 70" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 372 70 L 372 150 L 682 150 L 682 70" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 372 70 L 682 70" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="12px"><text x="526.5" y="59.5">tenant storage</text></g><g fill="rgb(0, 0, 0)" font-family="Helvetica" pointer-events="none" clip-path="url(#mx-clip-376-70-302-80-0)" font-size="12px"><text x="377.5" y="96.5">HashMap&lt;TenantId, Tenant&gt;</text><text x="377.5" y="124.5">Tenant state information, its sync and </text><text x="377.5" y="138.5">task manager interaction</text></g><path d="M 531.96 81.44 L 872.26 79.7" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 879.01 79.67 L 870.03 84.21 L 872.26 79.7 L 869.98 75.21 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 361.9 97.11 L 340.17 97.33" fill="none" stroke="#ff1a12" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 368.65 97.04 L 359.69 101.63 L 361.9 97.11 L 359.6 92.63 Z" fill="#ff1a12" stroke="#ff1a12" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 333.42 97.4 L 342.38 92.81 L 340.17 97.33 L 342.47 101.81 Z" fill="#ff1a12" stroke="#ff1a12" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 881.34 621.29 L 798.78 712.51" fill="none" stroke="#ff1a12" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 794.25 717.51 L 796.95 707.82 L 798.78 712.51 L 803.63 713.86 Z" fill="#ff1a12" stroke="#ff1a12" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 681px; margin-left: 934px;"><div data-drawio-colors="color: #000000; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; background-color: rgb(255, 255, 255); white-space: nowrap;"><font color="#ff1a12">layer map manages local and remote files<br />in a queue-based manner<br /></font></div></div></div></foreignObject><text x="934" y="684" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">layer map manages local and remote files...</text></switch></g><path d="M 485.35 157.6 L 352 310" fill="none" stroke="#ff1a12" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 489.79 152.52 L 487.25 162.26 L 485.35 157.6 L 480.48 156.33 Z" fill="#ff1a12" stroke="#ff1a12" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 230px; margin-left: 553px;"><div data-drawio-colors="color: #000000; background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; background-color: rgb(255, 255, 255); white-space: nowrap;"><font color="#ff1a12">tasks update or read metadata via the storage</font></div></div></div></foreignObject><text x="553" y="234" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">tasks update or read metadata via the storage</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 975px; margin-left: 97px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: nowrap;"><font style="font-size: 18px;"><b>Legend:</b></font></div></div></div></foreignObject><text x="97" y="979" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Legend:</text></switch></g><path d="M 312 975 L 202.1 974.61" fill="none" stroke="#ff1a12" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 195.35 974.58 L 204.37 970.11 L 202.1 974.61 L 204.34 979.11 Z" fill="#ff1a12" stroke="#ff1a12" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 975px; margin-left: 497px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: nowrap;"><font style="font-size: 13px;">interaction between components, <br />arrows show which component does the data access</font></div></div></div></foreignObject><text x="497" y="980" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="18px" text-anchor="middle">interaction between components,...</text></switch></g><path d="M 312 1060 L 202.1 1060" fill="none" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 195.35 1060 L 204.35 1055.5 L 202.1 1060 L 204.35 1064.5 Z" fill="#000000" stroke="#000000" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1060px; margin-left: 497px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: nowrap;"><span style="font-size: 13px;">data relation, <br />arrows show where current data is contained in</span></div></div></div></foreignObject><text x="497" y="1065" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="18px" text-anchor="middle">data relation,...</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>